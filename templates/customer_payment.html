{% include 'customer_header.html' %}

<!-- Flash Messages -->
<!--{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="container">
            {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else 'success' }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}-->

<div id="wrapper">
    <div id="container">
        <div id="left-col">
            <div id="left-col-cont">
                <h2>Choose Card</h2>
                {% for row in data['card'] %}
                <div class="item">
                    <div class="img-col">
                        <img src="/static/uploads/visa.jpg" alt="{{ row['card_name'] }}" />
                    </div>
                    <a href="?cardname={{ row['card_name'] }}&cardno={{ row['card_no'] }}&total={{ data['total'] }}&id={{ data['id'] }}">
                        <div class="meta-col">
                            <p class="card-name">{{ row['card_name'] }}</p>
                            <p class="card-number">{{ row['card_no'] }}</p>
                        </div>
                    </a>
                </div>
                {% else %}
                <span class="no-cards">You Have No Saved Cards</span>
                {% endfor %}
                <p class="total-label">Total</p>
                <h4 class="total-price"><span>â‚¹</span>{{ data['total'] }}</h4>
            </div>
        </div>
        <div id="right-col">
            <h2>Payment</h2>
            <div id="logotype">
                <img id="mastercard" src="http://emilcarlsson.se/assets/MasterCard_Logo.png" alt="MasterCard" />
            </div>
            <form action="" method="post" id="payment-form" novalidate>
                <div class="form-content">
                    <label for="cardno">Card Number</label>
                    <div id="cardnumbr">
                        <input 
                            type="text" 
                            maxlength="16" 
                            placeholder="0123 4567 8901 2345" 
                            name="cardno" 
                            id="cardno" 
                            value="{% if data['cardno'] %}{{ data['cardno'] }}{% endif %}" 
                            required 
                            oninput="validateCardNumber(this)"
                        />
                        <span id="cardno-error" style="color: red; font-size: 0.9em; display: none;">Card number must be exactly 16 digits.</span>
                    </div>
                    <label for="cardname">Cardholder</label>
                    <input 
                        id="cardholder" 
                        name="cardname" 
                        type="text" 
                        placeholder="John Doe" 
                        value="{% if data['cardname'] %}{{ data['cardname'] }}{% endif %}" 
                        required 
                        oninput="validateCardName(this)"
                    />
                    <span id="cardname-error" style="color: red; font-size: 0.9em; display: none;">Cardholder name must contain only letters and spaces.</span>
                    <div class="form-row">
                        <div class="left">
                            <label for="exp">Expiration Date</label>
                            <select id="month" name="exp_month" style="color: #555;" required>
                                <option value="">Month</option>
                                <option value="01">January</option>
                                <option value="02">February</option>
                                <option value="03">March</option>
                                <option value="04">April</option>
                                <option value="05">May</option>
                                <option value="06">June</option>
                                <option value="07">July</option>
                                <option value="08">August</option>
                                <option value="09">September</option>
                                <option value="10">October</option>
                                <option value="11">November</option>
                                <option value="12">December</option>
                            </select>
                            <select id="year" name="exp_year" style="color: #555;" required>
                                <option value="">Year</option>
                                <option value="2023">2023</option>
                                <option value="2024">2024</option>
                                <option value="2025">2025</option>
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                                <option value="2028">2028</option>
                                <option value="2029">2029</option>
                                <option value="2030">2030</option>
                                <option value="2031">2031</option>
                                <option value="2032">2032</option>
                            </select>
                        </div>
                        <div class="right">
                            <label for="cvv">CVV <i class="fa fa-question-circle-o" aria-hidden="true"></i></label>
                            <input 
                                id="cvc" 
                                type="text" 
                                name="cvv" 
                                placeholder="123" 
                                maxlength="3" 
                                required 
                                oninput="validateCVC(this)"
                            />
                            <span id="cvc-error" style="color: red; font-size: 0.9em; display: none;">CVV must be exactly 3 digits.</span>
                        </div>
                    </div>
                    <button id="purchase" name="pay" type="submit">Pay Now</button>
                </div>
                <p id="support">Having trouble? <a href="#">Contact Support</a></p>
            </form>
        </div>
    </div>
</div>
<script>
function validateCardNumber(input) {
    const error = document.getElementById('cardno-error');
    const value = input.value.replace(/\s/g, ''); // Remove spaces
    if (/^\d{0,16}$/.test(value)) {
        error.style.display = value.length === 16 ? 'none' : 'block';
        input.setCustomValidity(value.length === 16 ? '' : 'Card number must be exactly 16 digits');
    } else {
        error.style.display = 'block';
        input.setCustomValidity('Card number must contain only digits');
    }
}

function validateCardName(input) {
    const error = document.getElementById('cardname-error');
    const value = input.value;
    if (/^[A-Za-z ]*$/.test(value) && value.trim() !== '') {
        error.style.display = 'none';
        input.setCustomValidity('');
    } else {
        error.style.display = 'block';
        input.setCustomValidity('Cardholder name must contain only letters and spaces');
    }
}

function validateCVC(input) {
    const error = document.getElementById('cvc-error');
    const value = input.value;
    if (/^\d{0,3}$/.test(value)) {
        error.style.display = value.length === 3 ? 'none' : 'block';
        input.setCustomValidity(value.length === 3 ? '' : 'CVC must be exactly 3 digits');
    } else {
        error.style.display = 'block';
        input.setCustomValidity('CVC must contain only digits');
    }
}

document.getElementById('payment-form').addEventListener('submit', function(event) {
    const cardno = document.getElementById('cardno').value.replace(/\s/g, '');
    const cardname = document.getElementById('cardholder').value;
    const cvc = document.getElementById('cvc').value;

    if (!/^\d{16}$/.test(cardno)) {
        document.getElementById('cardno-error').style.display = 'block';
        event.preventDefault();
        return false;
    }
    if (!/^[A-Za-z ]+$/.test(cardname)) {
        document.getElementById('cardname-error').style.display = 'block';
        event.preventDefault();
        return false;
    }
    if (!/^\d{3}$/.test(cvc)) {
        document.getElementById('cvc-error').style.display = 'block';
        event.preventDefault();
        return false;
    }
    return true;
});
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<style>
    *:focus {
        outline: none;
    }

    body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        font-family: 'Poppins', sans-serif;
        margin: 0;
        padding: 0;
    }

    #wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }

    #container {
        background: #fff;
        height: 500px;
        width: 640px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
        border-radius: 15px;
        overflow: hidden;
        display: flex;
    }

    #left-col {
        width: 40%;
        height: 100%;
        background: linear-gradient(135deg, #2c3e50 0%, #1a2634 100%);
        color: #fff;
        padding: 20px;
        overflow-y: auto;
    }

    #left-col-cont {
        margin: 0;
    }

    #left-col-cont h2 {
        font-family: 'Roboto', sans-serif;
        font-size: 24px;
        font-weight: 600;
        margin: 20px 0;
        color: #fff;
    }

    .item {
        display: flex;
        align-items: center;
        margin: 15px 0;
        padding: 10px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        transition: transform 0.3s ease, background 0.3s ease;
    }

    .item:hover {
        transform: translateY(-5px);
        background: rgba(255, 255, 255, 0.2);
    }

    .img-col {
        width: 30%;
        padding: 0;
    }

    .img-col img {
        width: 100%;
        max-height: 60px;
        border-radius: 5px;
    }

    .meta-col {
        width: 70%;
        padding-left: 15px;
    }

    .card-name {
        font-size: 16px;
        font-weight: 500;
        margin: 0;
        color: #fff;
    }

    .card-number {
        font-size: 14px;
        font-weight: 400;
        margin: 5px 0 0 0;
        color: rgba(255, 255, 255, 0.8);
    }

    .no-cards {
        font-size: 16px;
        color: #ff6b6b;
        display: block;
        margin: 20px 0;
    }

    .total-label {
        font-size: 14px;
        text-transform: uppercase;
        opacity: 0.7;
        margin: 20px 0 5px 0;
    }

    .total-price {
        font-size: 28px;
        font-weight: 600;
        margin: 0;
        color: #fff;
    }

    .total-price span {
        color: #ffd700;
    }

    #right-col {
        width: 60%;
        padding: 20px 25px;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }

    #right-col h2 {
        font-family: 'Roboto', sans-serif;
        font-size: 24px;
        font-weight: 600;
        margin: 0 0 15px 0;
        color: #2c3e50;
    }

    #logotype {
        text-align: right;
    }

    #logotype img {
        width: 50px;
        height: auto;
    }

    .form-content {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }

    label {
        font-size: 12px;
        font-weight: 500;
        text-transform: uppercase;
        color: #7f8c8d;
        margin-bottom: 5px;
        display: block;
    }

    #cardnumbr input {
        width: 100%;
        padding: 12px;
        border: 1px solid #dfe6e9;
        border-radius: 8px;
        font-size: 16px;
        font-family: 'Poppins', sans-serif;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        transition: border-color 0.3s ease;
        margin-bottom: 15px;
    }

    #cardnumbr input:focus {
        border-color: #0984e3;
    }

    #cardholder {
        width: 100%;
        padding: 12px;
        border: 1px solid #dfe6e9;
        border-radius: 8px;
        font-size: 16px;
        margin-bottom: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        transition: border-color 0.3s ease;
    }

    #cardholder:focus {
        border-color: #0984e3;
    }

    .form-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-end;
        margin-bottom: 15px;
    }

    .left {
        width: 65%;
    }

    .right {
        width: 30%;
    }

    select {
        width: 48%;
        padding: 12px;
        border: 1px solid #dfe6e9;
        border-radius: 8px;
        font-size: 14px;
        font-family: 'Poppins', sans-serif;
        background: #fff;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        margin-right: 4%;
        transition: border-color 0.3s ease;
    }

    select:focus {
        border-color: #0984e3;
    }

    #cvc {
        width: 100%;
        padding: 12px;
        border: 1px solid #dfe6e9;
        border-radius: 8px;
        font-size: 14px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        transition: border-color 0.3s ease;
    }

    #cvc:focus {
        border-color: #0984e3;
    }

    #purchase {
        width: 100%;
        padding: 14px;
        background: #0984e3;
        color: #fff;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        text-transform: uppercase;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(9, 132, 227, 0.3);
        transition: background 0.3s ease, transform 0.2s ease;
    }

    #purchase:hover {
        background: #0652dd;
        transform: translateY(-2px);
    }

    #support {
        text-align: center;
        font-size: 12px;
        color: #7f8c8d;
        margin-top: 10px;
    }

    #support a {
        color: #0984e3;
        text-decoration: none;
        border-bottom: 1px solid #0984e3;
        transition: color 0.3s ease;
    }

    #support a:hover {
        color: #0652dd;
    }

    /* Payment Animation Overlay Styles */
    #payment-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
    }

    #gif-container {
        text-align: center;
        background: #fff;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
    }

    #gif-container img {
        max-width: 200px;
        height: auto;
    }

    #gif-container p {
        font-size: 18px;
        font-weight: 500;
        color: #2c3e50;
        margin-top: 15px;
    }
</style>

{% include 'footer.html' %}